<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0a1628">
    <title>Strategic Card Game</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/builder.css">
    <link rel="stylesheet" href="css/mobile.css">
</head>
<body>
    <div id="app">
        <!-- Main Menu Screen -->
        <div id="menu-screen" class="screen active">
            <!-- Navigation -->
            <nav class="nav-bar">
                <div class="nav-links">
                    <a href="/" class="active">Play</a>
                    <a href="/card-builder.html">Card Builder</a>
                    <a href="/deck-builder.html">Deck Builder</a>
                </div>
                <div class="user-info">
                    <span id="username-display"></span>
                    <button class="btn-logout" onclick="Auth.logout()">Logout</button>
                </div>
            </nav>

            <h1>Strategic Card Game</h1>
            <p class="subtitle">A game of pure strategy - no luck involved</p>

            <!-- Deck Selection -->
            <div id="deck-selection" class="deck-selection-box">
                <label>Select Your Deck:</label>
                <select id="deck-select" class="deck-selector">
                    <option value="">-- Select a deck --</option>
                </select>
            </div>

            <p id="no-deck-warning" class="warning-text" style="display: none;">
                You need to <a href="/card-builder.html">create cards</a> and
                <a href="/deck-builder.html">build a deck</a> to play!
            </p>

            <!-- Lobby Actions -->
            <div class="lobby-actions">
                <button id="create-lobby-btn" class="btn btn-primary" disabled>Create Game</button>
                <button id="refresh-lobbies-btn" class="btn btn-secondary">Refresh</button>
                <button id="how-to-play-btn" class="btn btn-secondary">How to Play</button>
            </div>

            <!-- Lobby Browser -->
            <div class="lobby-browser">
                <h3>Open Games</h3>
                <div id="lobby-list" class="lobby-list">
                    <p class="no-lobbies">No open lobbies. Create one to start playing!</p>
                </div>
            </div>
        </div>

        <!-- Lobby Waiting Screen -->
        <div id="lobby-screen" class="screen">
            <h2>Game Lobby</h2>
            <div class="lobby-details">
                <p class="lobby-code">Lobby Code: <strong id="lobby-id-display"></strong></p>

                <div class="lobby-players">
                    <div class="lobby-player">
                        <span class="player-label">Host:</span>
                        <span id="lobby-host-name" class="player-name"></span>
                    </div>
                    <div class="lobby-player">
                        <span class="player-label">Opponent:</span>
                        <span id="lobby-guest-name" class="player-name waiting">Waiting...</span>
                    </div>
                </div>

                <p id="lobby-status" class="lobby-status">Waiting for an opponent to join...</p>

                <div class="lobby-buttons">
                    <button id="add-bot-btn" class="btn btn-action" style="display: none;">Add Bot</button>
                    <button id="start-game-btn" class="btn btn-primary" disabled>Start Game</button>
                    <button id="leave-lobby-btn" class="btn btn-secondary">Leave Lobby</button>
                </div>
            </div>
        </div>

        <!-- How to Play Screen -->
        <div id="rules-screen" class="screen">
            <h2>How to Play</h2>
            <div class="rules-content">
                <h3>Objective</h3>
                <p>Reduce your opponent's health to 0 using strategic card play.</p>

                <h3>Game Flow</h3>
                <ul>
                    <li>Each player starts with 30 health and 4 cards</li>
                    <li>Player 2 draws an extra card to compensate for going second</li>
                    <li>Each turn you gain 1 base mana (up to 5) and draw 1 card</li>
                    <li>Play cards from your hand by spending mana</li>
                    <li>Attack with your units, then end your turn</li>
                </ul>

                <h3>Fortifications (Mana Lands)</h3>
                <ul>
                    <li>Base mana grows each turn: 1 ‚Üí 2 ‚Üí ... ‚Üí 10 (cap)</li>
                    <li>Each player has 7 fortifications to build (separate from deck)</li>
                    <li>Build fortifications for <strong>5 mana</strong> each</li>
                    <li>Each fortification adds +1 to your max mana</li>
                    <li>Max 7 fortifications on the battlefield at once</li>
                    <li>Fortifications have 5 health and can be attacked!</li>
                    <li>Destroyed fortifications return to your pool to rebuild</li>
                    <li>Destroy enemy fortifications to reduce their mana income</li>
                </ul>

                <h3>Unit Traits</h3>
                <h4>Positive Traits (cost points)</h4>
                <ul>
                    <li><strong>Swift:</strong> Can attack immediately when played</li>
                    <li><strong>Taunt:</strong> Enemies must attack this unit first</li>
                    <li><strong>Ranged:</strong> Attacks without receiving counter-damage</li>
                    <li><strong>Armor:</strong> Takes 1 less damage from all sources</li>
                    <li><strong>Charge:</strong> Deals DOUBLE damage when attacking</li>
                    <li><strong>Lifesteal:</strong> Heal your hero equal to damage dealt</li>
                    <li><strong>Divine Shield:</strong> Blocks the first instance of damage</li>
                    <li><strong>Inspire:</strong> Adjacent allies get +1/+1 at end of turn</li>
                    <li><strong>Piercing:</strong> Excess damage to units hits the enemy hero</li>
                    <li><strong>Regenerate:</strong> Heals 1 health at start of your turn</li>
                </ul>

                <h4>Negative Traits (refund points)</h4>
                <ul>
                    <li><strong>Frail:</strong> Dies to ANY damage (1 damage = death)</li>
                    <li><strong>Slow:</strong> Cannot attack for 1 turn after playing</li>
                    <li><strong>Fragile:</strong> Takes DOUBLE damage</li>
                    <li><strong>Costly:</strong> Costs 2 more mana</li>
                    <li><strong>Exhausting:</strong> Lose 2 mana next turn</li>
                    <li><strong>Soulbound:</strong> You lose 3 health when this dies</li>
                    <li><strong>Volatile:</strong> Dies at the end of your turn</li>
                    <li><strong>Pacifist:</strong> Can only attack enemy units (not heroes or lands)</li>
                </ul>

                <h3>No Luck Elements</h3>
                <p>All game mechanics are deterministic. The only hidden information is your opponent's hand. Deck order is determined by a fixed seed at game start.</p>
            </div>
            <button id="back-to-menu-btn" class="btn btn-primary">Back to Menu</button>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <!-- Game Board Background -->
            <div class="game-board">
                <!-- Opponent Side -->
                <div class="game-side opponent-side">
                    <!-- Opponent Hero Frame - Centered Layout -->
                    <div class="hero-frame opponent-hero-frame opponent-centered">
                        <div class="hero-info opponent-name-only">
                            <span class="hero-name" id="opponent-name-display">Opponent</span>
                        </div>
                        <div class="opponent-stats-centered">
                            <div class="opponent-stat-box mana-box">
                                <span class="stat-icon">&#9670;</span>
                                <span class="stat-value" id="opponent-mana">1/1</span>
                                <span class="stat-label">MANA</span>
                            </div>
                            <div class="opponent-stat-box deck-box">
                                <span class="stat-icon">&#9639;</span>
                                <span class="stat-value" id="opponent-deck">20</span>
                                <span class="stat-label">DECK</span>
                            </div>
                            <div class="opponent-stat-box hand-box">
                                <span class="stat-icon">&#9643;</span>
                                <span class="stat-value" id="opponent-hand-count">4</span>
                                <span class="stat-label">HAND</span>
                            </div>
                        </div>
                        <div class="hero-portrait opponent-hero-portrait" id="opponent-hero-target">
                            <div class="hero-portrait-inner">
                                <span class="hero-icon">&#9876;</span>
                            </div>
                            <div class="hero-health-orb">
                                <span id="opponent-health">30</span>
                            </div>
                        </div>
                    </div>

                    <!-- Opponent Lands Row -->
                    <div class="lands-row opponent-lands-row">
                        <div id="opponent-lands" class="lands-container"></div>
                    </div>

                    <!-- Opponent Mana Crystal Bar -->
                    <div class="mana-crystal-bar opponent-mana-bar">
                        <div id="opponent-mana-crystals" class="mana-crystals"></div>
                    </div>

                    <!-- Opponent Battlefield -->
                    <div class="battlefield opponent-battlefield">
                        <div class="battlefield-inner">
                            <div id="opponent-field" class="units-container"></div>
                        </div>
                    </div>
                </div>

                <!-- Center Arena -->
                <div class="arena-center">
                    <div class="arena-divider"></div>
                    <div class="turn-display">
                        <div id="turn-indicator" class="turn-gem">
                            <span id="turn-text">Your Turn</span>
                        </div>
                        <span id="turn-number" class="turn-counter">Turn 1</span>
                    </div>
                    <button id="end-turn-btn" class="end-turn-button">
                        <span class="btn-text">End Turn</span>
                        <span class="btn-glow"></span>
                    </button>
                </div>

                <!-- Player Side -->
                <div class="game-side player-side">
                    <!-- Player Battlefield -->
                    <div class="battlefield player-battlefield">
                        <div class="battlefield-inner">
                            <div id="player-field" class="units-container"></div>
                        </div>
                    </div>

                    <!-- Player Lands Row -->
                    <div class="lands-row player-lands-row">
                        <div id="player-lands" class="lands-container"></div>
                        <button id="play-land-btn" class="land-button" title="Build a Fortification (Cost: 5 mana)">
                            <span class="land-btn-icon">üè∞</span>
                            <span class="land-btn-text">Build</span>
                        </button>
                    </div>

                    <!-- Player Mana Crystal Bar -->
                    <div class="mana-crystal-bar player-mana-bar">
                        <div id="player-mana-crystals" class="mana-crystals"></div>
                    </div>

                    <!-- Player Hero Frame - Centered Layout -->
                    <div class="hero-frame player-hero-frame player-centered">
                        <div class="hero-portrait player-hero-portrait" id="player-hero">
                            <div class="hero-portrait-inner">
                                <span class="hero-icon">&#9876;</span>
                            </div>
                            <div class="hero-health-orb player-health-orb">
                                <span id="player-health">30</span>
                            </div>
                        </div>
                        <div class="player-stats-centered">
                            <div class="player-stat-box mana-box">
                                <span class="stat-icon">&#9670;</span>
                                <span class="stat-value" id="player-mana">1/1</span>
                                <span class="stat-label">MANA</span>
                            </div>
                            <div class="player-stat-box deck-box">
                                <span class="stat-icon">&#9639;</span>
                                <span class="stat-value" id="player-deck">20</span>
                                <span class="stat-label">DECK</span>
                            </div>
                            <div class="player-stat-box lands-box">
                                <span class="stat-icon">&#9632;</span>
                                <span class="stat-value" id="player-lands-count">7</span>
                                <span class="stat-label">LANDS</span>
                            </div>
                        </div>
                        <div class="hero-info player-name-only">
                            <span class="hero-name" id="player-name-display">You</span>
                        </div>
                    </div>
                </div>

                <!-- Player Hand Tray -->
                <div class="hand-tray">
                    <div class="hand-tray-inner">
                        <div id="player-hand" class="hand-container"></div>
                    </div>
                </div>
            </div>

            <!-- Event Log (Side Panel) -->
            <div id="event-log-panel" class="event-log-panel">
                <div class="event-log-header">
                    <span class="log-icon">&#9881;</span>
                    Battle Log
                </div>
                <div id="event-log" class="event-log-content"></div>
            </div>

            <!-- Game Messages -->
            <div id="game-messages"></div>

            <!-- Target Selection Overlay -->
            <div id="target-overlay" class="hidden">
                <div class="target-overlay-content">
                    <p id="target-prompt">Select a target</p>
                    <button id="cancel-target-btn" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="gameover-screen" class="screen">
            <h2 id="gameover-title">Game Over</h2>
            <p id="gameover-message"></p>
            <button id="play-again-btn" class="btn btn-primary">Play Again</button>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/client.js"></script>
</body>
</html>
